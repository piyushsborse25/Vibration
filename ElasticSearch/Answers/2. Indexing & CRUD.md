---

## **2. Indexing & CRUD (Q6–Q10)**

---

**6. What happens internally when you index a document in Elasticsearch?**

- **Answer:**
    
    1. Document is sent as JSON via REST API.
        
    2. The **primary shard** (chosen by routing) processes it.
        
    3. The JSON is parsed, fields are analyzed (tokenized, filtered) if applicable.
        
    4. Tokens are added to the inverted index.
        
    5. The document is stored in `_source` for retrieval.
        
    6. Operation is replicated to replica shards.
        
- **Pitfall Note:** Until a refresh happens, the new document won’t be searchable even though it’s indexed.
    

---

**7. How does Elasticsearch handle duplicate IDs during indexing?**

- **Answer:**
    
    - If you `POST /index/_doc` without an ID, ES generates one — so no overwrite.
        
    - If you `PUT /index/_doc/{id}` with an existing ID, ES replaces the document (creates a new version).
        
- **Pitfall Note:** Elasticsearch doesn’t modify the existing document in place — it marks the old one as deleted and writes a new segment entry.
    

---

**8. Difference between update API and index API when updating documents.**

- **Answer:**
    
    - **Index API:** Replaces the entire document (full overwrite).
        
    - **Update API:** Modifies only specified fields (`doc`), keeping others intact.
        
- **Pitfall Note:** Update API still reindexes the document internally — no true “partial write” like SQL’s UPDATE.
    

---

**9. What’s the difference between partial update and scripted update?**

- **Answer:**
    
    - **Partial update:** You pass a `doc` object with fields to change — simple replacements.
        
    - **Scripted update:** Uses `script` parameter to run inline code (e.g., increment a counter).
        
- **Pitfall Note:** Scripted updates can modify values dynamically but are slower and must be used with caution for security.
    

---

**10. Can you delete an index while it’s still being queried? What happens?**

- **Answer:**
    
    - Yes, ES will allow deletion — ongoing queries may fail with `index_not_found_exception`.
        
    - Cluster metadata is updated immediately.
        
- **Pitfall Note:** No “soft delete” for an index — deletion is permanent unless you have snapshots.
    

---