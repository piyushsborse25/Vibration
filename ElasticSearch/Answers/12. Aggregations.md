---

## **12. Aggregations (Q46–Q50)**

---

**46. What’s the difference between metric and bucket aggregations?**

- **Answer:**
    
    - **Metric aggregations** → Calculate values (sum, avg, max, min, stats).
        
    - **Bucket aggregations** → Group documents into buckets (terms, date_histogram, range).
        
- **Pitfall Note:** Buckets don’t calculate values directly; must nest metrics inside.
    

---

**47. How does a terms aggregation work?**

- **Answer:**
    
    - Groups docs by **exact value** of a keyword field.
        
    - Default size = 10 buckets (can increase with `size` parameter).
        
- **Pitfall Note:** Running terms on `text` fields will fail unless `.keyword` subfield exists.
    

---

**48. What’s the difference between terms and significant_terms aggregation?**

- **Answer:**
    
    - **terms**: Shows most frequent terms overall.
        
    - **significant_terms**: Shows terms unusually frequent in your query subset compared to all docs.
        
- **Pitfall Note:** `significant_terms` is slower — avoid on huge datasets without filtering first.
    

---

**49. How does date_histogram aggregation work?**

- **Answer:**
    
    - Groups docs into time-based buckets (day, month, year) using a date field.
        
    - Supports `fixed_interval` and `calendar_interval`.
        
- **Pitfall Note:** Using `fixed_interval` for months can cause drift due to different month lengths.
    

---

**50. How do you get both raw data and aggregations in one query?**

- **Answer:**
    
    - Use `search` API with both `query` and `aggs` in the same request.
        
    - Example:
        
        ```json
        {
          "query": { "match_all": {} },
          "aggs": {
            "avg_price": { "avg": { "field": "price" } }
          }
        }
        ```
        
- **Pitfall Note:** If you set `"size": 0`, you’ll get only aggregations without docs.
    

---