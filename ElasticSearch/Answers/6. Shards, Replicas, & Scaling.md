---

## **6. Shards, Replicas, & Scaling (Q26–Q30)**

---

**26. What’s the difference between a primary shard and a replica shard?**

- **Answer:**
    
    - **Primary shard**: The original copy of the data; handles indexing requests.
        
    - **Replica shard**: Copy of the primary shard; provides redundancy and can serve search requests.
        
- **Pitfall Note:** Write operations always go to the primary shard first, then are replicated.
    

---

**27. How does Elasticsearch decide which shard to store a document in?**

- **Answer:**
    
    - Uses a formula:
        
        ```
        shard = hash(_routing) % number_of_primary_shards
        ```
        
        By default, `_routing` = document ID.
        
- **Pitfall Note:** Changing number of primary shards changes routing results, so reindexing is required.
    

---

**28. Can you change the number of primary shards after index creation?**

- **Answer:**
    
    - No, primary shard count is fixed at index creation.
        
    - To change, you must create a new index with the desired shard count and reindex.
        
- **Pitfall Note:** You **can** change replica count dynamically.
    

---

**29. What happens when a node containing a primary shard fails?**

- **Answer:**
    
    - Elasticsearch promotes a replica shard to primary.
        
    - Missing replicas are re-created from existing primaries when the failed node recovers or new nodes join.
        
- **Pitfall Note:** If there are no replicas and a primary is lost, the data in that shard is lost permanently.
    

---

**30. How does shard rebalancing work during cluster scaling?**

- **Answer:**
    
    - When nodes join or leave, ES automatically redistributes shards to balance load, based on allocation rules.
        
    - Controlled by `cluster.routing.allocation.*` settings.
        
- **Pitfall Note:** Large shard movements can cause performance degradation — sometimes manual allocation control is better during peak load.
    

---