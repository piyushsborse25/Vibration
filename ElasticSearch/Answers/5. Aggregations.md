---

## **5. Aggregations (Q21–Q25)**

---

**21. What’s the difference between bucket and metric aggregations?**

- **Answer:**
    
    - **Bucket aggregations**: Group documents into buckets based on a criterion (e.g., `terms`, `range`, `date_histogram`).
        
    - **Metric aggregations**: Calculate numeric metrics (e.g., `avg`, `sum`, `max`, `min`, `stats`).
        
- **Pitfall Note:** Metric aggregations do not create buckets — they only produce numbers.
    

---

**22. How would you get the top 5 terms in a field based on a count?**

- **Answer:**
    
    - Use a `terms` aggregation with `size: 5`.
        
    - Example:
        
        ```json
        {
          "aggs": {
            "top_terms": {
              "terms": { "field": "category.keyword", "size": 5 }
            }
          }
        }
        ```
        
- **Pitfall Note:** Avoid using analyzed `text` fields — use `.keyword` or a non-analyzed field for terms aggregations.
    

---

**23. What is the significant terms aggregation used for?**

- **Answer:**
    
    - Finds terms that are **unusually frequent** in a subset of documents compared to the rest of the dataset.
        
    - Useful for anomaly detection and relevance analysis.
        
- **Pitfall Note:** It is more computationally expensive than normal `terms` aggregation.
    

---

**24. Can you run aggregations on analyzed text fields? Why or why not?**

- **Answer:**
    
    - No, because analyzed fields are tokenized into multiple terms. Aggregations work on exact values, not tokens.
        
    - Use `keyword` fields or `fielddata` (but enabling fielddata is memory-heavy).
        
- **Pitfall Note:** Enabling `fielddata` for text fields can cause large heap usage and OOM errors.
    

---

**25. How do you combine filters and aggregations to improve performance?**

- **Answer:**
    
    - Use a `filter` aggregation or a `post_filter` query to limit the documents that the aggregation runs on.
        
    - This avoids scoring overhead and reduces aggregation load.
        
- **Pitfall Note:** Use `filter` aggregations instead of `must` in bool queries when you don’t care about scores.
    

---